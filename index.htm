<html>

<head>
    <title>The Tiny Library</title>
    <link href="lib/prism.css" rel="stylesheet">
    <link href="index.css" rel="stylesheet">
    <script type="text/javascript" src="lib/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="lib/prism.js"></script>
    <script type="text/javascript" src="tiny.js"></script>
    <script type="text/javascript" src="index.js"></script>
</head>

<body>
    <div class="sidebar">
    </div>
    <div id="content-block" class="content">

        <h1>The Tiny Function Library</h1>

        <h2>Overview</h2>
        <p>This small library is meant to provide some handy functions which are missing in DOM manipulating frameworks like
            jQuery or others.</p>
        <p>And it doesn't want to be another armed-to-teeth full featured framework (might also be hard-to-learn).</p>
        <p>Its goal is providing a minimalist building foundation for modern App-like web pages.</p>

        <hr/>

        <h2>Basic Functions</h2>

        <h3>Console Shorthands</h3>
        <p>Meet the <code>_log()</code>, <code>_info()</code>, <code>_warn()</code>, <code>_error()</code> and helper function
            <code>_xObj()</code>.</p>
        <p>You can easily turn the console log on or off by calling <code>_tiny.showLog()</code> in develop or production environments.</p>
        <p>By default <code>_log()</code> is turned off, you don't want to show everything to the end users, do you?</p>
        <h4>EXAMPLE</h4>
        <pre><code class="run-code language-javascript">
                // enable _log() output when you need them
                _tiny.showLog(true);

                // use them as you would like the console.xxx equivalents
                _log('----------------------------');
                _info('Object created:', {title: 'Untitled', id: 1, author: 'me'});
                _warn('Don\'t do it', 'or nothing would happen');
                _error('An error happened');

                // And if you want a flatten view of an object
                // try the _xObj() helper function
                _log( 'Flatten Object =', _xObj( {
                    id: 123,
                    view: { loaded: true,
                            date: new Date() },
                    method: function(){}
                }) );

                // check your browser's console for the output of above statements
                ASSERT( true );
            </code></pre>

        <hr/>

        <h3>_each()</h3>
        <p>A handy replacement to the <code>for(;;)</code> and <code>for...in</code> loop.</p>
        <p>It works like <code>Array.forEach()</code> method, but you can use it on Objects and do continue or break with a
            return value.</p>
        <pre class="usage"><code class="language-javascript">
            _each(array_or_object, function(value, index, array) {
                return;              // continue to next item in array_or_object
                return any_value;    // break out, and _each() will return any_value
            }, this_arg)             // set 'this' keyword inside the scope to this_arg if given
            </code></pre>
        <h4>EXAMPLE</h4>
        <pre><code class="run-code language-javascript">
            //==== Work with Array ================
            var numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            _each(numbers, function (value, index, array) {
                if (value < 4) return;       // continue
                if (value > 6) return true;  // break
                array[index] = value * 10;
            });
            ASSERT( numbers.join() === '1,2,3,40,50,60,7,8,9' );

            // you can get returned value like this
            var big = _each(numbers, function (value, index, array) {
                if (value > 10)
                    return value;  // return first number bigger than 10
            });
            ASSERT( big === 40 );

            //==== Work with Object ================
            var list = { book: 'book', pen: 'pen' };
            var my_string = '';
            _each(list, function (value, label) {
                my_string += 'It\'s my ' + value + '. ';
            });
            ASSERT( my_string === 'It\'s my book. It\'s my pen. ' );
        </code></pre>
        <h4>ERRORS</h4>
        <pre><code class="run-code language-javascript">
            // A TypeError will be thrown on invalid parameter types
            // Detailed information can be found in console
            try{
                _each('_each error test 1');
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
            try{
                _each([1, 2, 3], '_each error test 2');
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
            </code></pre>

        <hr/>

        <h3>_extend()</h3>
        <p>Extend an object with new properties. This function does not do deep extension.</p>
        <p>And Javscript preserved keywords can not be used or overwritten.</p>
        <pre class="usage"><code class="language-javascript">
            _extend(target, extensions, keep_old)
            // target     - the target Object or Function you want to extend
            // extensions - an Object contains extensions that will be applied to target
            // keep_old   - set true to skip existing properties
        </code></pre>
        <h4>EXAMPLE</h4>
        <pre><code class="run-code language-javascript">
            var point = { x: 1, y: 2 };
            var point_3d = _extend(point, {z: 3});
            ASSERT( JSON.stringify(point_3d) === '{"x":1,"y":2,"z":3}' );

            // x will be overwrite
            var point_4d = _extend(point_3d, {x: 10, t: 4});
            ASSERT( JSON.stringify(point_4d) === '{"x":10,"y":2,"z":3,"t":4}' );

            // x & y will not be overwrite
            point_4d = _extend(point_3d, {x: 100, y: 100}, true);
            ASSERT( JSON.stringify(point_4d) === '{"x":10,"y":2,"z":3,"t":4}' );
        </code></pre>
        <h4>ERRORS</h4>
        <pre><code class="run-code language-javascript">
            // A TypeError will be thrown on invalid parameter types
            // Detailed information can be found in console
            try{
                _extend('_extend error test 1');
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
            try{
                _extend({}, '_extend error test 2');
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
            </code></pre>

        <hr/>

        <h3>_namespace()</h3>
        <p>Create a namespace and return the object.</p>
        <p>You can't create namespace with Javascript preserved keywords. The result might appear like nothing has happened.</p>
        <pre class="usage"><code class="language-javascript">
            _namespace(namespace, obj)
            // namespace  - a string which represent the namespace path
            // obj        - the object which will be bind to that namespace
        </code></pre>
        <h4>EXAMPLE</h4>
        <pre><code class="run-code language-javascript">
            // just create a blank namespace
            _namespace('my.project');
            ASSERT( JSON.stringify(my.project) === '{}' );

            // add something to it
            var ns_obj = _namespace('my.project.lib', { id: 1, type: 'blank' });
            ASSERT( my.project.lib.id === 1 );
            ASSERT( ns_obj.type === 'blank' );
        </code></pre>
        <h4>ERRORS</h4>
        <pre><code class="run-code language-javascript">
            // A TypeError will be thrown on invalid parameter types
            // Detailed information can be found in console
            try{
                _namespace(['_namespace', 'error test', 1]);
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
            try{
                _namespace('ex.test.2', '_namespace error test 2');
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
            </code></pre>

        <hr/>

        <h2>Message System</h2>

        <p>This tiny library includes a basic pseudo message system. Messages are more like remote function calls.</p>
        <p>In order to distinguish from the DOM Event system, it is named _message.</p>
        <p>Though it's not real asynchronize message delivery, it should be enough for most use cases on browser client.</p>

        <h3>_message.listen()</h3>
        <p>Register a message listener.</p>
        <p>There is no unlisten() method, since you can easily drop a message in your message handler by checking internal flag
            (and you definitely will have an internal flag in such case).</p>
        <pre class="usage"><code class="language-javascript">
            _message.listen(message_name, function(msg_name, param_1, param_2 ...){
                // message handler stetements
            })
        </code></pre>

        <h3>_message.post()</h3>
        <p>Post a message to listeners.</p>
        <pre class="usage"><code class="language-javascript">
            _message.post(msg_name, param_1, param_2 ...)
        </code></pre>

        <h3>_message.postDelayed()</h3>
        <p>Post a message to listeners after a specified delay.</p>
        <p>If the same message is triggered again, the delay time will be reset. This behavior is suit for implement Type-n-Search
            like features.</p>
        <pre class="usage"><code class="language-javascript">
            _message.postDelayed(delay_time, msg_name, param_1, param_2 ...)
            // Wait for delay_time milliseconds before posting the message
        </code></pre>

        <h4>EXAMPLE</h4>
        <pre><code class="run-code language-javascript">
            var list = [];

            // define the message handler
            function put_in_list(){
                var args = Array.prototype.slice.call(arguments);
                list = list.concat(args);
            }

            // listen to the message
            _message.listen('put_in_list', put_in_list);

            // post a message
            _message.post('put_in_list', 'me', 123);
            // check result
            ASSERT( JSON.stringify(list) == '["me",123]' );

            // post a delayed message
            _message.postDelayed(1000, 'put_in_list', 'you', 456);
            // check result after 1 second
            setTimeout(function(){
                ASSERT( JSON.stringify(list) == '["me",123,"you",456]' );
            }, 1000);
        </code></pre>
        <h4>ERRORS</h4>
        <pre><code class="run-code language-javascript">
            // A TypeError will be thrown on invalid parameter types
            // Detailed information can be found in console
            try{
                _message.listen(['_message.listen', 'error test', 1]);
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
            try{
                _message.listen('my_msg', '_message.listen error test 2');
                FAIL_TEST();
            }catch(err){
                ASSERT( err instanceof TypeError );
            }
        </code></pre>

        <hr/>

        <h2>Router System</h2>

        <p>Router is used to indicate a stateful view by a persistent URL.</p>
        <p>With it you can access or share content directly with an URL, go back &amp; forth with the browser buttons.</p>
        <p>It should not be used for temporary view like a popup dialog or represent an action to execute.</p>
        <p>This is why the router system of Tiny is this simple.</p>
        <p>And for simplicity and compatibility, this router system uses <code>window.location.hash</code> (#string) for routing,
            other than the History API introduced in HTML5.</p>
        <p>And Tiny provides a predefined View Manager for fast implement of views.</p>

        <h3>_route.watch()</h3>
        <p>Watch a certain route.</p>
        <p>There is no unwatch() method, since you can easily drop a call in your route handler by checking internal flag (and
            you definitely will have an internal flag in such case).</p>
        <p>The <code>route</code> parameter can be a string or a RegExp object.</p>

        <pre class="usage"><code class="language-javascript">
            _route.watch(route, function(route, param_object){
                // route handler statements
            })
        </code></pre>
        <p>The callback function will be called every time the hash string is changed, no matter current route is matching or
            not.
        </p>
        <p>The <code>route</code> parameter of the callback function will be current hash string.</p>
        <p>And the <code>param_object</code> will be <code>true</code> or an <code>Object</code> contains paramters mateched
            in URL.</p>
        <p>If watched route is not matched, the <code>param_object</code> will be <code>false</code>.</p>


    </div>
</body>

</html>